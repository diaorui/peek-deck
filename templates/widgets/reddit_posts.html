<style>
/* Reddit specific card styling */
.widget-reddit-posts .carousel-card {
    border-left: 3px solid #FF4500;
    display: flex;
    flex-direction: column;
    max-width: 100%; /* Prevent any child from expanding card */
    min-width: 0; /* Allow flex children to shrink below content size */
    flex-shrink: 0;
}

.widget-reddit-posts .carousel-card:hover {
    box-shadow: 0 4px 12px rgba(255, 69, 0, 0.2);
}

    .widget-reddit-posts .post-thumbnail {
        width: 100%;
        aspect-ratio: 2 / 1;
        border-radius: 4px;
        margin-bottom: 10px;
        background-color: rgba(255, 255, 255, 0.03);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        position: relative;
        overflow: hidden;
    }

    .widget-reddit-posts .post-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }

    /* Fallback icon - always shown by default */
    .widget-reddit-posts .post-thumbnail::before {
        content: "ðŸ’¬";
        opacity: 0.3;
        z-index: 0;
        position: relative;
    }

    .widget-reddit-posts .post-content {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-width: 0; /* Allow flex children to shrink below content size */
    }

    .widget-reddit-posts .post-title {
        font-size: 0.95rem;
        font-weight: 500;
        margin-bottom: 8px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: calc(0.95rem * 1.4 * 2);
        min-width: 0;
    }

    .widget-reddit-posts .post-description {
        font-size: 0.75rem;
        color: #9ca3af;
        line-height: 1.4;
        margin-bottom: 10px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: calc(0.75rem * 1.4 * 3);
        min-width: 0;
    }

    .widget-reddit-posts .post-meta {
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 0.72rem;
        color: #9ca3af;
        margin-top: auto;
        min-width: 0;
    }

    .widget-reddit-posts .post-meta-line {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;
        overflow: hidden;
        min-width: 0;
    }

    .widget-reddit-posts .post-meta-item {
        display: flex;
        align-items: center;
        gap: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        min-width: 0;
    }

    .widget-reddit-posts .post-meta-item span,
    .widget-reddit-posts .post-meta-item a {
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Prioritize time over link when space is limited */
    .widget-reddit-posts .post-meta-item:has([data-timestamp]) {
        flex-shrink: 0;
    }

    .widget-reddit-posts .post-meta-item.post-source {
        flex-shrink: 1;
        min-width: 0;
    }

    .widget-reddit-posts .post-author {
        font-weight: 500;
    }

    /* External source link */
    .widget-reddit-posts .post-source {
        color: #60a5fa;
    }

    .widget-reddit-posts .post-source a {
        display: flex;
        align-items: center;
        gap: 4px;
        color: #60a5fa;
        text-decoration: none;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .widget-reddit-posts .post-source a:hover {
        text-decoration: underline;
    }

    .widget-reddit-posts .post-favicon {
        width: 14px;
        height: 14px;
        object-fit: contain;
        flex-shrink: 0;
    }

    .widget-reddit-posts .post-title a {
        color: var(--text-color);
        text-decoration: none;
    }

    .widget-reddit-posts .post-title a:hover {
        color: #FF4500;
    }

    /* Mobile adjustments: more lines for better readability */
    @media (max-width: 768px) {
        .widget-reddit-posts .post-thumbnail {
            /* aspect-ratio already set above */
        }

        .widget-reddit-posts .post-title {
            -webkit-line-clamp: 3;
            min-height: calc(0.95rem * 1.4 * 3);
        }

        .widget-reddit-posts .post-description {
            -webkit-line-clamp: 4;
            min-height: calc(0.75rem * 1.4 * 4);
        }
    }
</style>

<div class="widget widget-reddit-posts">
    <div class="widget-header">
        <h3><a href="https://www.reddit.com/r/{{ subreddit }}/rising" target="_blank" style="color: inherit; text-decoration: none;">Reddit Discussions</a></h3>
        <div style="font-size: 0.75rem; color: #9ca3af;">
            r/{{ subreddit }} Â· Rising
        </div>
    </div>
    <div class="widget-body">
        <div class="carousel-container">
            <!-- Previous button -->
            <button class="carousel-nav carousel-nav-prev" aria-label="Previous">
                â—€
            </button>

            <!-- Carousel track -->
            <div class="carousel-track" id="reddit-carousel-{{ subreddit|replace('_', '-')|lower }}">
                {% for post in posts %}
                <div class="carousel-card" onclick="window.open('{{ post.url }}', '_blank')">
                    <div class="post-thumbnail">
                        {% if post.thumbnail %}
                        <img src="{{ post.thumbnail }}" alt="{{ post.title }}" onerror="this.style.display='none'" loading="lazy">
                        {% endif %}
                    </div>

                    <div class="post-content">
                        <!-- Post title -->
                        <div class="post-title">
                            <a href="{{ post.url }}" target="_blank" onclick="event.stopPropagation();">{{ post.title }}</a>
                        </div>

                        <!-- Rich description (if available) -->
                        {% if post.description %}
                        <div class="post-description">
                            {{ post.description }}
                        </div>
                        {% endif %}

                        <!-- Metadata -->
                        <div class="post-meta">
                            <div class="post-meta-line">
                                {% if post.published %}
                                <div class="post-meta-item">
                                    <span data-timestamp="{{ post.published }}"></span>
                                </div>
                                {% endif %}
                                <!-- External article source (on same line as time) -->
                                {% if post.external_url %}
                                <div class="post-meta-item post-source">
                                    <a href="{{ post.external_url }}" target="_blank" onclick="event.stopPropagation();">
                                        {% if post.site_name %}
                                            {% if post.favicon %}
                                            <img src="{{ post.favicon }}" alt="" class="post-favicon" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';" loading="lazy">
                                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="flex-shrink: 0; display: none;">
                                                <path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                                                <path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                                            </svg>
                                            {% else %}
                                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="flex-shrink: 0;">
                                                <path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                                                <path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                                            </svg>
                                            {% endif %}
                                        {% endif %}
                                        <span>{{ post.site_name or 'ðŸ”— article' }}</span>
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- View All button at end of carousel -->
                <div class="carousel-card"
                    style="display: flex; align-items: center; justify-content: center; cursor: pointer; background: rgba(255, 69, 0, 0.05); border-color: #FF4500;"
                    onclick="window.open('https://www.reddit.com/r/{{ subreddit }}/rising', '_blank')">
                    <div style="text-align: center;">
                        <svg width="48" height="48" viewBox="0 0 24 24" style="margin-bottom: 8px; fill: #FF4500;">
                            <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                        </svg>
                        <div style="color: #FF4500; font-weight: 500; font-size: 0.9rem;">View All</div>
                        <div style="color: #9ca3af; font-size: 0.75rem; margin-top: 4px;">on Reddit</div>
                    </div>
                </div>
            </div>

            <!-- Next button -->
            <button class="carousel-nav carousel-nav-next" aria-label="Next">
                â–¶
            </button>
        </div>

    </div>
    <div class="widget-footer">
        <small data-timestamp="{{ timestamp_iso }}">Updated {{ timestamp_iso }}</small>
    </div>
</div>

<!-- Carousel initialized by shared page.html script -->
